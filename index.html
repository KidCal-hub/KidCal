<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KidCal ‚Äì Never Miss Deadlines of What Matters for Your Kids, Again!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f5f5fb;
      --card-bg: #ffffff;
      --primary: #4b7bec;
      --primary-soft: rgba(75, 123, 236, 0.08);
      --danger: #e74c3c;
      --text: #1f2933;
      --muted: #6b7280;
      --radius-lg: 18px;
      --radius-sm: 10px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: linear-gradient(135deg, #eef2ff, #fdfdfd);
      color: var(--text);
    }

    .page {
      max-width: 1180px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 24px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-icon {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 0 0, #ffd6a5, #ff6b6b);
      color: white;
      font-weight: 700;
      box-shadow: 0 8px 20px rgba(248, 113, 113, 0.3);
    }

    .brand-text-title {
      font-weight: 700;
      font-size: 1.15rem;
    }

    .brand-text-sub {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .tagline {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .hero {
      background: var(--card-bg);
      box-shadow: var(--shadow-soft);
      border-radius: 24px;
      padding: 20px 18px;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(260px, 1.3fr);
      gap: 18px;
      margin-bottom: 20px;
    }

    @media (max-width: 840px) {
      .hero {
        grid-template-columns: 1fr;
      }
      header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .hero h1 {
      font-size: 1.7rem;
      margin: 0 0 10px;
    }

    .hero p {
      margin: 0 0 12px;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .hero-badge {
      background: var(--primary-soft);
      color: #1e40af;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .hero-badge span {
      font-size: 1rem;
    }

    .hero-cta {
      margin-top: 14px;
    }

    .hero-cta small {
      display: block;
      color: var(--muted);
      font-size: 0.75rem;
    }

    .hero-panel {
      background: radial-gradient(circle at 0 0, #bfdbfe, #eef2ff);
      border-radius: 20px;
      padding: 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .hero-panel-title {
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #1d4ed8;
    }

    .hero-panel-list {
      display: grid;
      gap: 6px;
      font-size: 0.85rem;
    }

    .hero-panel-item {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      background: rgba(255, 255, 255, 0.9);
      padding: 6px 8px;
      border-radius: 999px;
      align-items: center;
    }

    .hero-panel-item strong {
      font-size: 0.82rem;
    }

    .hero-panel-item span {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .hero-panel-footer {
      font-size: 0.78rem;
      color: #1f2933;
    }

    .search-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 16px 16px 14px;
      margin-bottom: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }

    .search-group {
      flex: 1 1 260px;
      display: flex;
      gap: 8px;
    }

    .search-group input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #d0d7e2;
      font-size: 0.9rem;
      outline: none;
    }

    .search-group input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.25);
    }

    button {
      border: none;
      cursor: pointer;
      font-family: inherit;
    }

    .btn-primary {
      padding: 10px 14px;
      border-radius: 12px;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.35);
      white-space: nowrap;
    }

    .btn-primary span {
      font-size: 1rem;
    }

    .btn-ghost {
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.02);
      font-size: 0.8rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-ghost span {
      font-size: 1rem;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(260px, 1.1fr);
      gap: 18px;
      align-items: flex-start;
    }

    @media (max-width: 980px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .results-card,
    .reminders-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 14px 14px 16px;
    }

    .results-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .results-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .results-subtitle {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .pill-group {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .pill {
      font-size: 0.78rem;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.12);
      color: #475569;
      cursor: pointer;
      border: none;
    }

    .pill.active {
      background: var(--primary);
      color: white;
    }

    .results-list {
      display: grid;
      gap: 10px;
      margin-top: 6px;
    }

    .result-item {
      border-radius: var(--radius-sm);
      border: 1px solid #e5e7eb;
      padding: 9px 10px;
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.1fr) auto;
      gap: 8px;
      align-items: center;
    }

    @media (max-width: 720px) {
      .result-item {
        grid-template-columns: 1fr;
        align-items: flex-start;
      }
    }

    .result-main-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .result-main-meta {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .result-dates {
      font-size: 0.8rem;
      color: #111827;
    }

    .result-dates span {
      display: inline-block;
      margin-right: 8px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      background: rgba(16, 185, 129, 0.08);
      padding: 2px 8px;
      font-size: 0.75rem;
      color: #059669;
    }

    .chip span {
      font-size: 0.95rem;
    }

    .result-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    .btn-sm {
      font-size: 0.78rem;
      padding: 6px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-sm.secondary {
      background: #f9fafb;
      color: #374151;
    }

    a {
      color: #1d4ed8;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .reminders-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 10px;
    }

    .reminders-title-box {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .reminders-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .reminders-subtitle {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .reminders-tools {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .reminders-list {
      display: grid;
      gap: 8px;
      max-height: 340px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .reminder-item {
      border-radius: var(--radius-sm);
      border: 1px solid #e5e7eb;
      padding: 8px 9px;
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto;
      gap: 6px;
      font-size: 0.82rem;
      align-items: center;
    }

    .reminder-main-title {
      font-weight: 600;
      font-size: 0.85rem;
    }

    .reminder-meta {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .reminder-label {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 0.76rem;
      border-radius: 999px;
      padding: 2px 7px;
      background: rgba(59, 130, 246, 0.08);
      color: #1d4ed8;
      margin-right: 6px;
    }

    .reminder-actions {
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-end;
    }

    .btn-icon {
      padding: 4px;
      border-radius: 999px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .btn-icon:hover {
      background: #fee2e2;
      color: var(--danger);
    }

    .empty-state {
      font-size: 0.8rem;
      color: var(--muted);
      padding: 6px 2px 2px;
    }

    .pill-filter-caption {
      font-size: 0.76rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .footer-note {
      margin-top: 18px;
      font-size: 0.74rem;
      color: var(--muted);
      text-align: center;
    }

    .reminders-list::-webkit-scrollbar {
      width: 5px;
    }
    .reminders-list::-webkit-scrollbar-thumb {
      background: #cbd5f5;
      border-radius: 999px;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">
        <div class="brand-icon">K</div>
        <div>
          <div class="brand-text-title">KidCal</div>
          <div class="brand-text-sub">One place for every kid deadline</div>
        </div>
      </div>
      <div class="tagline">San Luis Obispo County prototype</div>
    </header>

    <section class="hero">
      <div>
        <h1>Never Miss Deadlines of What Matters for Your Kids, Again!</h1>
        <p>
          Enter your city or ZIP and get key registration links and kids programs
          for San Luis Obispo County in one place. Add them to your own
          reminder list in seconds.
        </p>
        <div class="hero-badges">
          <div class="hero-badge">
            <span>üìÖ</span> School enrollment
          </div>
          <div class="hero-badge">
            <span>üèÖ</span> Youth sports leagues
          </div>
          <div class="hero-badge">
            <span>üé®</span> Camps & activities
          </div>
        </div>
        <div class="hero-cta">
          <small>
            Try: ‚ÄúAtascadero‚Äù, ‚ÄúSan Luis Obispo‚Äù, ‚ÄúPaso Robles‚Äù, ‚ÄúNipomo‚Äù, ‚ÄúTempleton‚Äù‚Ä¶  
            ZIP codes work too.
          </small>
        </div>
      </div>
      <div class="hero-panel">
        <div class="hero-panel-title">Sample upcoming deadlines</div>
        <div class="hero-panel-list" id="hero-deadlines"></div>
        <div class="hero-panel-footer">
          This panel uses sample data. In a full build, it would show
          live, location-based deadlines for your kids.
        </div>
      </div>
    </section>

    <section class="search-card">
      <div class="search-group">
        <input
          id="locationInput"
          type="text"
          placeholder="Enter city or ZIP code in San Luis Obispo County..."
        />
        <button class="btn-primary" id="searchBtn" type="button">
          <span>üîç</span> Find registrations
        </button>
      </div>
      <button class="btn-ghost" id="useSampleBtn" type="button">
        <span>‚ú®</span> Try generic sample list
      </button>
    </section>

    <section class="layout">
      <div class="results-card">
        <div class="results-header">
          <div>
            <div class="results-title">Registration finder</div>
            <div class="results-subtitle" id="resultsSubtitle">
              Enter a San Luis Obispo County city or town to see links and programs.
            </div>
          </div>
          <div class="pill-group" id="filterPills">
            <button class="pill active" data-filter="all">All</button>
            <button class="pill" data-filter="school">School</button>
            <button class="pill" data-filter="sports">Sports</button>
            <button class="pill" data-filter="event">Events</button>
          </div>
        </div>
        <div class="pill-filter-caption">
          Filter by type, then tap ‚ÄúAdd to my reminders‚Äù to build your do-not-miss list.
        </div>
        <div class="results-list" id="resultsList"></div>
      </div>

      <aside class="reminders-card">
        <div class="reminders-header">
          <div class="reminders-title-box">
            <div class="reminders-title">My reminder calendar</div>
            <div class="reminders-subtitle">
              Saved on this device. Download an .ics file to import into your own calendar.
            </div>
          </div>
          <div class="reminders-tools">
            <button class="btn-sm secondary" id="clearRemindersBtn" type="button">
              üßπ Clear
            </button>
            <button class="btn-sm" id="downloadIcsBtn" type="button">
              üì• Download .ics
            </button>
          </div>
        </div>
        <div class="reminders-list" id="remindersList"></div>
        <div class="empty-state" id="remindersEmpty">
          No reminders yet. Add a school or sports registration from the list to see it here.
        </div>
      </aside>
    </section>

    <div class="footer-note">
      Prototype only. Dates and offerings change each season. Always confirm on the
      linked district or recreation site before you rely on a deadline.
    </div>
  </div>

  <script>
    // ---------------------------
    // Static location data ‚Äì SLO County cities and major towns (fallback)
    // ---------------------------
    const LOCATION_DATA = {
      atascadero: {
        locationLabel: "Atascadero, CA 93422",
        items: [
          {
            id: "atascadero-ausd-tk-kinder-2025",
            title: "AUSD Transitional Kindergarten and Kindergarten Enrollment 2025‚Äì26",
            org: "Atascadero Unified School District",
            type: "school",
            registrationOpen: "2025-03-01",
            registrationClose: "2025-03-31",
            eventDate: null,
            url: "https://atascaderousd.aeries.net/air/",
            notes:
              "Online enrollment for new TK and Kindergarten students for 2025‚Äì26 runs March 1‚Äì31, 2025. Requires online Aeries account and residency, age, and immunization documents."
          },
          {
            id: "atascadero-youth-soccer-fall-2025",
            title: "Atascadero Youth Soccer League ‚Äì Fall 2025 Season",
            org: "Atascadero Youth Soccer League (AYSL)",
            type: "sports",
            registrationOpen: "2025-04-08",
            registrationClose: "2025-06-16",
            eventDate: "2025-09-06",
            url: "https://www.atascaderosoccer.org/",
            notes:
              "Fall 2025 schedule lists early bird registration opening April 8, discount through May 19, and final registration closing June 16. First games scheduled for September 6, 2025; divisions fill to capacity."
          },
          {
            id: "atascadero-winter-basketball-2025-26",
            title: "City of Atascadero Winter Youth Basketball 2025‚Äì26",
            org: "City of Atascadero Recreation",
            type: "sports",
            registrationOpen: null,
            registrationClose: null,
            eventDate: "2026-01-10",
            url: "https://www.atascadero.org/service/youth-sports",
            notes:
              "City winter youth basketball league with practices beginning early December and games on Saturdays from January 10 through March 7, 2026. Registration and skills clinics open in the fall through the city recreation site."
          }
        ]
      },

      arroyo_grande: {
        locationLabel: "Arroyo Grande, CA 93420",
        items: [
          {
            id: "arroyo-grande-rec-classes",
            title: "Recreation Services ‚Äì Sports, Camps, and Family Events",
            org: "City of Arroyo Grande Recreation Services",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://secure.rec1.com/CA/arroyo-grande-ca/catalog",
            notes:
              "Arroyo Grande Recreation Services offers seasonal youth sports, classes, and special events with online registration through the Rec1 catalog. Check activity listings for current sports leagues and kids programs."
          },
          {
            id: "five-cities-youth-basketball",
            title: "Five Cities Youth Basketball League",
            org: "5 Cities Youth Basketball",
            type: "sports",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://5cyb.sportngin.com/",
            notes:
              "Recreational basketball league serving Arroyo Grande, Grover Beach, Pismo Beach, Shell Beach, and Oceano for grades 1‚Äì8. Registration windows and season dates are posted each year on the league site."
          }
        ]
      },

      grover_beach: {
        locationLabel: "Grover Beach, CA 93433",
        items: [
          {
            id: "grover-beach-community-services-programs",
            title: "Grover Beach Community Services ‚Äì Activities and Events",
            org: "Grover Beach Community Services",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://anc.apm.activecommunities.com/groverbeachparks/home?onlineSiteId=0",
            notes:
              "Grover Beach Community Services offers classes, special events, and seasonal activities for youth and families. View the current activity guide and register online through the ActiveNet portal."
          }
        ]
      },

      morro_bay: {
        locationLabel: "Morro Bay, CA 93442",
        items: [
          {
            id: "morro-bay-estero-basketball",
            title: "Estero Bay Youth Basketball League",
            org: "City of Morro Bay Recreation Services",
            type: "sports",
            registrationOpen: null,
            registrationClose: null,
            eventDate: "2026-01-10",
            url: "https://www.morrobayca.gov/338/Sports-Leagues---Youth",
            notes:
              "Basketball league for youth in approximately 2nd‚Äì8th grade. Registration takes place in October, practices begin in December, and games run from early January through early March in Morro Bay and the Estero Bay area."
          },
          {
            id: "morro-bay-kids-club",
            title: "Kid's Club Before and After School Care 2025‚Äì26",
            org: "City of Morro Bay Recreation Services",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.morrobayca.gov/292/Recreation-Services",
            notes:
              "Kid's Club provides before and after school care for elementary students in Morro Bay. Pre-registration information for the 2025‚Äì26 school year is posted on the Recreation Services page each spring."
          }
        ]
      },

      paso_robles: {
        locationLabel: "Paso Robles, CA 93446",
        items: [
          {
            id: "paso-junior-giants-2025",
            title: "Paso Robles Junior Giants 2025 Baseball and Softball",
            org: "Paso Robles Recreation / Junior Giants",
            type: "sports",
            registrationOpen: "2025-04-01",
            registrationClose: "2025-07-31",
            eventDate: "2025-06-09",
            url: "https://www.prcity.com/CivicAlerts.asp?AID=1328",
            notes:
              "Free Junior Giants summer baseball and softball league with T-Ball, Minors, and Majors divisions. Registration typically runs April through July, with practices starting in June and games through early August at Barney Schwartz Park."
          },
          {
            id: "paso-youth-baseball-spring",
            title: "Paso Robles Youth Baseball ‚Äì Spring Season",
            org: "Paso Robles Youth Baseball",
            type: "sports",
            registrationOpen: "2025-10-11",
            registrationClose: "2026-01-09",
            eventDate: null,
            url: "https://www.pasobaseball.org/",
            notes:
              "Spring youth baseball registration opens in October and remains open into early January, with early bird discounts before the end of October. Practices and games are held at local Paso Robles fields."
          },
          {
            id: "paso-rec-youth-activities",
            title: "Paso Robles Recreation Youth Classes and Sports",
            org: "Paso Robles Recreation Services",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://apm.activecommunities.com/PRCityRecreation",
            notes:
              "Paso Robles Recreation Services uses ActiveNet for youth classes, camps, and leagues, including Youth Evolution basketball programs and other activities at Centennial Park. Check current listings for specific session dates."
          }
        ]
      },

      pismo_beach: {
        locationLabel: "Pismo Beach, CA 93449",
        items: [
          {
            id: "pismo-winter-theater-camp-2026",
            title: "Creative Kids Company Winter Theater Camp ‚Äì January 2026",
            org: "City of Pismo Beach Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: "2026-01-05",
            url: "https://www.activekids.com/orgs/city-of-pismo-beach-recreation",
            notes:
              "City of Pismo Beach Recreation offers seasonal camps including Creative Kids Company Winter Theater Camp (for example January 5‚Äì9, 2026) plus surf camps and martial arts. Current offerings and dates appear in the online activity guide."
          },
          {
            id: "pismo-rec-activity-guide",
            title: "Pismo Beach Recreation ‚Äì Youth Programs and Activity Guide",
            org: "Pismo Beach Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.pismobeach.org/73/Recreation",
            notes:
              "Pismo Beach Recreation publishes an activity guide with youth sports, camps, and classes. Families can view current youth programs and register online through the linked portals."
          }
        ]
      },

      san_luis_obispo: {
        locationLabel: "San Luis Obispo, CA 93401",
        items: [
          {
            id: "slcusb-tk-2025-26",
            title: "San Luis Coastal USD ‚Äì Transitional Kindergarten Enrollment 2025‚Äì26",
            org: "San Luis Coastal Unified School District",
            type: "school",
            registrationOpen: "2025-03-03",
            registrationClose: null,
            eventDate: null,
            url: "https://www.slcusd.org/academics/transitional-kindergarten-tk",
            notes:
              "For 2025‚Äì26, students turning four on or before September 1, 2025 are eligible for TK. Enrollment for TK opens March 3, 2025 through the SLCUSD online enrollment portal and continues while space is available."
          },
          {
            id: "slo-youth-basketball-clinic-dec-2025",
            title: "SLO Youth Basketball Pre-Season Clinic ‚Äì December 2025",
            org: "City of San Luis Obispo Parks and Recreation",
            type: "sports",
            registrationOpen: null,
            registrationClose: null,
            eventDate: "2025-12-01",
            url: "https://www.activekids.com/san-luis-obispo-ca/basketball/basketball-clinics/youth-basketball-pre-season-clinic-6-8-years-2025",
            notes:
              "Pre-season youth basketball clinic for ages around 6‚Äì8, held December 1‚Äì17, 2025 at SLO Parks and Recreation. Registration and details are posted through the SLO Parks and Recreation activity search."
          },
          {
            id: "slo-ymca-futsal-2025",
            title: "SLO County YMCA Spring Youth Futsal League 2025",
            org: "SLO County YMCA / City of San Luis Obispo",
            type: "sports",
            registrationOpen: null,
            registrationClose: null,
            eventDate: "2025-04-11",
            url: "https://channel.recliquecore.com/programs/1542/san-luis-obispo-futsal-league/?locations=140",
            notes:
              "Indoor futsal league in partnership with the City of San Luis Obispo Parks and Recreation. Practices are held Monday through Thursday with games on Fridays starting April 11, 2025. Age divisions and registration details are on the YMCA site."
          }
        ]
      },

      nipomo: {
        locationLabel: "Nipomo, CA 93444",
        items: [
          {
            id: "nipomo-ayso-fall-2025",
            title: "AYSO Region 716 ‚Äì Nipomo Fall 2025 Soccer",
            org: "AYSO Region 716 Nipomo",
            type: "sports",
            registrationOpen: null,
            registrationClose: "2025-08-03",
            eventDate: "2025-08-16",
            url: "https://ayso.bluesombrero.com/Default.aspx?tabid=954819",
            notes:
              "Fall soccer runs roughly August 16 to October 25, 2025. Registration fee discounts apply through about August 3. Exact registration window and fee details are posted on the Region 716 registration page."
          },
          {
            id: "nipomo-little-league-2026",
            title: "Nipomo Little League ‚Äì 2026 Season",
            org: "Nipomo Little League",
            type: "sports",
            registrationOpen: null,
            registrationClose: "2026-01-13",
            eventDate: "2026-03-07",
            url: "https://www.nipomolittleleague.com/Default.aspx?tabid=1768597",
            notes:
              "Nipomo Little League offers spring baseball with multiple divisions including Challenger. For some programs, registration closes January 13, 2026, with the season running March through late May. See the league site for division specific dates."
          },
          {
            id: "nipomo-recreation-youth-programs",
            title: "Nipomo Recreation ‚Äì Youth Basketball and Programs",
            org: "Nipomo Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.nipomorecreation.com/",
            notes:
              "Nipomo Recreation provides youth basketball, before and after school care, preschool and toddler programs, and events for families from ages 6 weeks through 8th grade. Program dates and registration are posted on their website."
          }
        ]
      },

      templeton: {
        locationLabel: "Templeton, CA 93465",
        items: [
          {
            id: "templeton-youth-basketball-2025-26",
            title: "Templeton Youth Basketball League 2025‚Äì26",
            org: "Templeton Recreation Department",
            type: "sports",
            registrationOpen: null,
            registrationClose: "2025-12-20",
            eventDate: "2026-01-10",
            url: "https://leagues.bluesombrero.com/Default.aspx?tabid=1713824",
            notes:
              "Templeton Recreation Youth Basketball 2025‚Äì26 includes divisions such as 7th and 8th grade girls, with registration closing December 20, 2025 and season dates from January 10 through March 7, 2026."
          },
          {
            id: "templeton-youth-soccer-2025",
            title: "Templeton Recreation ‚Äì Youth Soccer League",
            org: "Templeton Community Services District",
            type: "sports",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://leagues.bluesombrero.com/Default.aspx?tabid=1352276",
            notes:
              "Templeton Recreation runs youth soccer, softball, T-ball, basketball, flag football, and other seasonal programs. The youth soccer program offers divisions from under-10 through under-14. Registration dates vary by season."
          },
          {
            id: "templeton-parks-recreation",
            title: "Templeton Parks and Recreation ‚Äì Youth Sports Programs",
            org: "Templeton Community Services District",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.templetoncsd.org/111/Parks-Recreation",
            notes:
              "Templeton Parks and Recreation coordinates multiple youth sports leagues and community events, including fall soccer, winter basketball, spring softball and T-ball, and summer flag football."
          }
        ]
      },

      cambria: {
        locationLabel: "Cambria, CA 93428",
        items: [
          {
            id: "cambria-county-rec-programs",
            title: "SLO County Parks and Recreation ‚Äì Youth Programs (Cambria area)",
            org: "San Luis Obispo County Parks and Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
            notes:
              "Families in Cambria can access countywide classes, camps, and recreation programs offered by San Luis Obispo County Parks and Recreation, including youth and family activities listed on the county recreation programs page."
          }
        ]
      },

      los_osos: {
        locationLabel: "Los Osos, CA 93402",
        items: [
          {
            id: "los-osos-county-rec-programs",
            title: "SLO County Parks and Recreation ‚Äì Youth Programs (Los Osos area)",
            org: "San Luis Obispo County Parks and Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
            notes:
              "Residents of Los Osos and the surrounding community can participate in county recreation programs such as youth classes and camps offered at regional parks and facilities across San Luis Obispo County."
          }
        ]
      },

      oceano: {
        locationLabel: "Oceano, CA 93445",
        items: [
          {
            id: "oceano-five-cities-basketball",
            title: "Five Cities Youth Basketball ‚Äì Oceano Area",
            org: "5 Cities Youth Basketball",
            type: "sports",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://5cyb.sportngin.com/",
            notes:
              "Five Cities Youth Basketball serves communities including Oceano, Arroyo Grande, Grover Beach, Pismo Beach, and Shell Beach with youth basketball leagues. Registration and season details are maintained on the league site."
          }
        ]
      },

      avila_beach: {
        locationLabel: "Avila Beach, CA 93424",
        items: [
          {
            id: "avila-beach-county-rec-programs",
            title: "SLO County Parks and Recreation ‚Äì Coastal Youth Programs",
            org: "San Luis Obispo County Parks and Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
            notes:
              "Avila Beach families can take part in county parks and recreation programs and classes, including offerings in nearby coastal communities, with schedules updated regularly on the county website."
          }
        ]
      },

      cayucos: {
        locationLabel: "Cayucos, CA 93430",
        items: [
          {
            id: "cayucos-county-rec-programs",
            title: "SLO County Parks and Recreation ‚Äì Youth Programs (Cayucos area)",
            org: "San Luis Obispo County Parks and Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
            notes:
              "Cayucos area families can access countywide youth recreation programs, including classes, sports, and activity camps coordinated through SLO County Parks and Recreation."
          }
        ]
      },

      san_miguel: {
        locationLabel: "San Miguel, CA 93451",
        items: [
          {
            id: "san-miguel-county-rec-programs",
            title: "SLO County Parks and Recreation ‚Äì Youth Programs (San Miguel area)",
            org: "San Luis Obispo County Parks and Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
            notes:
              "San Miguel families can connect to county recreation offerings and regional programs in nearby Paso Robles and Templeton for youth sports and activities."
          }
        ]
      },

      san_simeon: {
        locationLabel: "San Simeon, CA 93452",
        items: [
          {
            id: "san-simeon-county-rec-programs",
            title: "SLO County Parks and Recreation ‚Äì Youth Programs (San Simeon area)",
            org: "San Luis Obispo County Parks and Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
            notes:
              "Families in San Simeon can access county recreation programming and nearby coastal youth activities via SLO County Parks and Recreation and regional partners."
          }
        ]
      },

      santa_margarita: {
        locationLabel: "Santa Margarita, CA 93453",
        items: [
          {
            id: "santa-margarita-county-rec-programs",
            title: "SLO County Parks and Recreation ‚Äì Youth Programs (Santa Margarita area)",
            org: "San Luis Obispo County Parks and Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
            notes:
              "Santa Margarita families can use SLO County Parks and Recreation youth classes and camps, along with sports programs in Atascadero and San Luis Obispo."
          }
        ]
      },

      shandon: {
        locationLabel: "Shandon, CA 93461",
        items: [
          {
            id: "shandon-county-rec-programs",
            title: "SLO County Parks and Recreation ‚Äì Youth Programs (Shandon area)",
            org: "San Luis Obispo County Parks and Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
            notes:
              "Families in Shandon can participate in countywide youth recreation programs and nearby youth leagues in Paso Robles and Templeton."
          }
        ]
      },

      creston: {
        locationLabel: "Creston, CA 93432",
        items: [
          {
            id: "creston-county-rec-programs",
            title: "SLO County Parks and Recreation ‚Äì Youth Programs (Creston area)",
            org: "San Luis Obispo County Parks and Recreation",
            type: "event",
            registrationOpen: null,
            registrationClose: null,
            eventDate: null,
            url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
            notes:
              "Creston area families can access youth recreation through SLO County programs and nearby Templeton and Atascadero leagues."
          }
        ]
      },

      // Generic sample data, used for hero panel and fallback
      sample: {
        locationLabel: "Sample Family Calendar",
        items: [
          {
            id: "sample-school",
            title: "Elementary School ‚Äì New Student Registration",
            org: "Your Local School District",
            type: "school",
            registrationOpen: "2025-03-01",
            registrationClose: "2025-04-15",
            eventDate: null,
            url: "https://school.example.com/registration",
            notes: "Typical documents include proof of age, residence, and immunizations."
          },
          {
            id: "sample-soccer",
            title: "Youth Soccer League ‚Äì Fall Season",
            org: "City Youth Soccer League",
            type: "sports",
            registrationOpen: "2025-05-10",
            registrationClose: "2025-06-20",
            eventDate: null,
            url: "https://soccer.example.com/register",
            notes: "Ages 5‚Äì12; practices start in August with Saturday games."
          },
          {
            id: "sample-swim",
            title: "Swim Lessons Session 2",
            org: "Community Pool",
            type: "sports",
            registrationOpen: "2025-04-01",
            registrationClose: "2025-04-30",
            eventDate: "2025-06-01",
            url: "https://pool.example.com/swim-lessons",
            notes: "Levels 1‚Äì3; choose morning or afternoon time slots."
          },
          {
            id: "sample-camp",
            title: "Art and Music Summer Camp",
            org: "Local Arts Center",
            type: "event",
            registrationOpen: "2025-02-15",
            registrationClose: "2025-05-01",
            eventDate: "2025-07-15",
            url: "https://arts.example.com/camp",
            notes: "Week-long day camp with visual art and music; scholarships available."
          }
        ]
      }
    };

    // Map search input -> location id
    const LOCATION_MATCH_RULES = [
      { id: "atascadero",       keys: ["atascadero", "93422", "93423"] },
      { id: "arroyo_grande",    keys: ["arroyo grande", "93420", "93421"] },
      { id: "grover_beach",     keys: ["grover beach", "93433", "93483"] },
      { id: "morro_bay",        keys: ["morro bay", "93442", "93443"] },
      { id: "paso_robles",      keys: ["paso robles", "el paso de robles", "93446", "93447"] },
      { id: "pismo_beach",      keys: ["pismo beach", "93449", "93448"] },
      { id: "san_luis_obispo",  keys: ["san luis obispo", "slo ", " slo", "93401", "93405", "93406", "93407", "93408", "93409", "93410", "93403"] },
      { id: "nipomo",           keys: ["nipomo", "93444"] },
      { id: "templeton",        keys: ["templeton", "93465"] },
      { id: "cambria",          keys: ["cambria", "93428"] },
      { id: "los_osos",         keys: ["los osos", "93402", "93412"] },
      { id: "oceano",           keys: ["oceano", "93445"] },
      { id: "avila_beach",      keys: ["avila beach", "93424"] },
      { id: "cayucos",          keys: ["cayucos", "93430"] },
      { id: "san_miguel",       keys: ["san miguel", "93451"] },
      { id: "san_simeon",       keys: ["san simeon", "93452"] },
      { id: "santa_margarita",  keys: ["santa margarita", "93453"] },
      { id: "shandon",          keys: ["shandon", "93461"] },
      { id: "creston",          keys: ["creston", "93432"] }
    ];

    // ---------------------------
    // Google Sheet configuration
    // ---------------------------
    const SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vSTGyzF9lGXW8a1--CtEYzaQFhZnkU0Ye8InlnVPgbmyYaiYzy8wPEgGp2dVodt-GEbonPHKGRKQJwl/pub?gid=0&single=true&output=csv";

    // Map of location_id -> { locationLabel, items: [...] } loaded from sheet
    const sheetLocationData = {};

    // Tiny CSV parser for simple comma-separated rows (no complex quoting)
    function parseCsv(text) {
      const lines = text.trim().split(/\r?\n/);
      if (!lines.length) return [];

      const headers = lines[0].split(",").map(h => h.trim());
      return lines.slice(1).map(line => {
        const cols = line.split(",");
        const obj = {};
        headers.forEach((h, i) => {
          obj[h] = (cols[i] || "").trim();
        });
        return obj;
      });
    }

    async function loadSheetData() {
      try {
        if (!SHEET_CSV_URL) {
          console.info("No SHEET_CSV_URL set; using static data only.");
          return;
        }
        const res = await fetch(SHEET_CSV_URL);
        if (!res.ok) {
          console.warn("Could not load sheet, status:", res.status);
          return;
        }
        const text = await res.text();
        const rows = parseCsv(text);

        rows.forEach(row => {
          const locId = row.location_id;
          if (!locId) return;

          if (!sheetLocationData[locId]) {
            sheetLocationData[locId] = {
              locationLabel: row.location_label || (LOCATION_DATA[locId]?.locationLabel || locId),
              items: []
            };
          }

          sheetLocationData[locId].items.push({
            id: row.item_id || `${locId}-${sheetLocationData[locId].items.length}`,
            title: row.title || "",
            org: row.org || "",
            type: row.type || "event",
            registrationOpen: row.registration_open || null,
            registrationClose: row.registration_close || null,
            eventDate: row.event_date || null,
            url: row.url || "",
            notes: row.notes || ""
          });
        });

        console.log("Loaded sheet data for locations:", Object.keys(sheetLocationData));
      } catch (err) {
        console.error("Error loading sheet data:", err);
      }
    }

    // ---------------------------
    // State
    // ---------------------------
    let currentFilter = "all";
    let currentItems = [];
    let reminders = [];

    // ---------------------------
    // Helpers
    // ---------------------------
    function formatDate(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr + "T00:00:00");
      if (Number.isNaN(d.getTime())) return dateStr;
      return d.toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
    }

    function saveReminders() {
      try {
        localStorage.setItem("kidcal-reminders", JSON.stringify(reminders));
      } catch (e) {}
    }

    function loadReminders() {
      try {
        const saved = localStorage.getItem("kidcal-reminders");
        if (saved) reminders = JSON.parse(saved);
      } catch (e) {
        reminders = [];
      }
      renderReminders();
    }

    function findDataForLocation(input) {
      if (!input) return null;
      const trimmed = input.trim();
      if (!trimmed) return null;
      const lower = trimmed.toLowerCase();

      // 1) Try to match any SLO County city/town by name or ZIP
      let matchedLocationId = null;

      for (const rule of LOCATION_MATCH_RULES) {
        for (const key of rule.keys) {
          if (/^\d{5}$/.test(key)) {
            // ZIP code must match exactly
            if (trimmed === key) {
              matchedLocationId = rule.id;
              break;
            }
          } else {
            if (lower.includes(key)) {
              matchedLocationId = rule.id;
              break;
            }
          }
        }
        if (matchedLocationId) break;
      }

      if (matchedLocationId) {
        // 1a) Prefer sheet-backed data if available
        if (sheetLocationData[matchedLocationId]) {
          return sheetLocationData[matchedLocationId];
        }
        // 1b) Fallback to static seed data
        if (LOCATION_DATA[matchedLocationId]) {
          return LOCATION_DATA[matchedLocationId];
        }
      }

      // 2) If nothing matched but it looks like SLO County in general
      if (lower.includes("san luis obispo county") || lower.includes("slo county")) {
        return {
          locationLabel: "San Luis Obispo County (general)",
          items: [
            {
              id: "slo-county-parks-programs",
              title: "SLO County Parks and Recreation ‚Äì Countywide Youth Programs",
              org: "San Luis Obispo County Parks and Recreation",
              type: "event",
              registrationOpen: null,
              registrationClose: null,
              eventDate: null,
              url: "https://www.slocounty.ca.gov/departments/parks-recreation/services/recreation-programs-and-services",
              notes:
                "Countywide recreation programs, classes, and camps for youth and families across San Luis Obispo County. Use the county recreation site to search for offerings near your town."
            }
          ]
        };
      }

      // 3) Fallback: generic sample data
      return {
        locationLabel: trimmed,
        items: LOCATION_DATA.sample.items
      };
    }

    // ---------------------------
    // Rendering
    // ---------------------------
    function renderResults() {
      const listEl = document.getElementById("resultsList");
      listEl.innerHTML = "";

      const filtered = currentItems.filter((item) => {
        if (currentFilter === "all") return true;
        return item.type === currentFilter;
      });

      if (!filtered.length) {
        listEl.innerHTML =
          '<div class="empty-state">No items for this filter. Try another type, or check the linked site directly for more programs.</div>';
        return;
      }

      filtered.forEach((item) => {
        const wrapper = document.createElement("div");
        wrapper.className = "result-item";

        const main = document.createElement("div");
        const dates = document.createElement("div");
        const actions = document.createElement("div");

        main.innerHTML = `
          <div class="result-main-title">${item.title}</div>
          <div class="result-main-meta">
            ${item.org} ‚Ä¢ <span style="text-transform: capitalize;">${item.type}</span>
          </div>
        `;

        const datePieces = [];
        if (item.registrationOpen) {
          datePieces.push(
            `<span>Opens: <strong>${formatDate(item.registrationOpen)}</strong></span>`
          );
        }
        if (item.registrationClose) {
          datePieces.push(
            `<span>Closes: <strong>${formatDate(item.registrationClose)}</strong></span>`
          );
        }
        if (item.eventDate) {
          datePieces.push(
            `<span class="chip"><span>‚≠ê</span> Starts: <strong>${formatDate(
              item.eventDate
            )}</strong></span>`
          );
        }

        dates.className = "result-dates";
        dates.innerHTML = datePieces.join("");

        actions.className = "result-actions";
        actions.innerHTML = `
          <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="btn-sm secondary">
            üîó Open details
          </a>
        `;

        const addBtn = document.createElement("button");
        addBtn.className = "btn-sm";
        addBtn.type = "button";
        addBtn.innerHTML = "‚ûï Add to my reminders";
        addBtn.addEventListener("click", () => addReminder(item));
        actions.appendChild(addBtn);

        if (item.notes) {
          const notesEl = document.createElement("div");
          notesEl.style.fontSize = "0.78rem";
          notesEl.style.color = "#6b7280";
          notesEl.style.marginTop = "2px";
          notesEl.textContent = item.notes;
          main.appendChild(notesEl);
        }

        wrapper.appendChild(main);
        wrapper.appendChild(dates);
        wrapper.appendChild(actions);
        listEl.appendChild(wrapper);
      });
    }

    function renderReminders() {
      const listEl = document.getElementById("remindersList");
      const emptyEl = document.getElementById("remindersEmpty");
      listEl.innerHTML = "";

      if (!reminders.length) {
        emptyEl.style.display = "block";
        return;
      }
      emptyEl.style.display = "none";

      reminders
        .slice()
        .sort((a, b) => {
          const aDate = a.registrationClose || a.registrationOpen || a.eventDate || "9999-12-31";
          const bDate = b.registrationClose || b.registrationOpen || b.eventDate || "9999-12-31";
          return new Date(aDate) - new Date(bDate);
        })
        .forEach((item, index) => {
          const wrapper = document.createElement("div");
          wrapper.className = "reminder-item";

          const main = document.createElement("div");
          const actions = document.createElement("div");
          actions.className = "reminder-actions";

          const typeLabel = `<span class="reminder-label">${
            item.type === "school"
              ? "üè´ School"
              : item.type === "sports"
              ? "üèÖ Sports"
              : "üéü Event"
          }</span>`;

          const keyDate =
            item.registrationClose ||
            item.registrationOpen ||
            item.eventDate;
          const keyLabel = item.registrationClose
            ? "Registration closes"
            : item.registrationOpen
            ? "Registration opens"
            : "Event date";

          main.innerHTML = `
            <div class="reminder-main-title">${item.title}</div>
            <div class="reminder-meta">
              ${typeLabel}
              <span>${item.org}</span>
              ${
                keyDate
                  ? `<br/><strong>${keyLabel}:</strong> ${formatDate(keyDate)}`
                  : ""
              }
            </div>
          `;

          const linkBtn = document.createElement("a");
          linkBtn.href = item.url;
          linkBtn.target = "_blank";
          linkBtn.rel = "noopener noreferrer";
          linkBtn.className = "btn-sm secondary";
          linkBtn.textContent = "üîó View details";

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn-icon";
          deleteBtn.type = "button";
          deleteBtn.title = "Remove reminder";
          deleteBtn.innerHTML = "‚úï";
          deleteBtn.addEventListener("click", () => {
            reminders.splice(index, 1);
            saveReminders();
            renderReminders();
          });

          actions.appendChild(linkBtn);
          actions.appendChild(deleteBtn);

          wrapper.appendChild(main);
          wrapper.appendChild(actions);
          listEl.appendChild(wrapper);
        });
    }

    function renderHeroDeadlines() {
      const container = document.getElementById("hero-deadlines");
      container.innerHTML = "";
      const sampleItems = LOCATION_DATA.sample.items.slice(0, 3);
      sampleItems.forEach((item) => {
        const keyDate =
          item.registrationClose ||
          item.registrationOpen ||
          item.eventDate;
        const label = item.registrationClose
          ? "Closes"
          : item.registrationOpen
          ? "Opens"
          : "Starts";

        const el = document.createElement("div");
        el.className = "hero-panel-item";
        el.innerHTML = `
          <div>
            <strong>${item.title}</strong>
            <br />
            <span>${item.org}</span>
          </div>
          <div style="text-align: right; font-size: 0.8rem;">
            <div>${label}</div>
            <div><strong>${formatDate(keyDate)}</strong></div>
          </div>
        `;
        container.appendChild(el);
      });
    }

    // ---------------------------
    // Actions
    // ---------------------------
    function addReminder(item) {
      const exists = reminders.some((r) => r.id === item.id);
      if (!exists) {
        reminders.push(item);
        saveReminders();
        renderReminders();
      } else {
        alert("This item is already in your reminders.");
      }
    }

    async function handleSearch() {
      const inputEl = document.getElementById("locationInput");
      const input = inputEl.value.trim();
      const subtitleEl = document.getElementById("resultsSubtitle");
      const listEl = document.getElementById("resultsList");

      if (!input) {
        subtitleEl.textContent = "Enter a city or ZIP to see results.";
        listEl.innerHTML = "";
        currentItems = [];
        renderResults();
        return;
      }

      subtitleEl.textContent = `Looking up registrations for "${input}"...`;
      listEl.innerHTML = "";

      try {
        const data = findDataForLocation(input);
        currentItems = data.items || [];

        subtitleEl.textContent = currentItems.length
          ? `Showing results for ${data.locationLabel}. Always confirm dates on the linked site.`
          : `No events found yet for ${data.locationLabel}. Try a nearby city or check the linked site directly.`;

        renderResults();
      } catch (err) {
        console.error(err);
        subtitleEl.textContent =
          "We had trouble fetching data. Please try again in a moment.";
        listEl.innerHTML =
          '<div class="empty-state">Error rendering events.</div>';
      }
    }

    function handleUseSample() {
      const data = LOCATION_DATA.sample;
      currentItems = data.items;
      document.getElementById("resultsSubtitle").textContent =
        "Showing generic sample data. Connect more real data sources over time.";
      renderResults();
    }

    function handleFilterClick(e) {
      const btn = e.target.closest(".pill");
      if (!btn) return;

      currentFilter = btn.dataset.filter;
      document
        .querySelectorAll("#filterPills .pill")
        .forEach((el) => el.classList.remove("active"));
      btn.classList.add("active");
      renderResults();
    }

    function generateICS() {
      if (!reminders.length) {
        alert("No reminders to export yet.");
        return;
      }

      const lines = [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "PRODID:-//KidCal//EN"
      ];

      reminders.forEach((item, idx) => {
        const now = new Date();
        const dtstamp = now
          .toISOString()
          .replace(/[-:]/g, "")
          .replace(/\.\d{3}Z$/, "Z");

        const dateStr =
          item.registrationClose ||
          item.registrationOpen ||
          item.eventDate ||
          null;

        let dtstart = "";
        if (dateStr) {
          const d = new Date(dateStr + "T00:00:00");
          const y = d.getFullYear();
          const m = String(d.getMonth() + 1).padStart(2, "0");
          const day = String(d.getDate()).padStart(2, "0");
          dtstart = `${y}${m}${day}`;
        }

        lines.push("BEGIN:VEVENT");
        lines.push(`UID:${idx}-${Date.now()}@kidcal`);
        lines.push(`DTSTAMP:${dtstamp}`);
        if (dtstart) {
          lines.push(`DTSTART;VALUE=DATE:${dtstart}`);
        }
        lines.push(`SUMMARY:${item.title.replace(/,/g, "\\,")}`);
        const descParts = [];
        if (item.org) descParts.push(`Org: ${item.org}`);
        if (item.url) descParts.push(`Link: ${item.url}`);
        if (item.registrationOpen)
          descParts.push(
            `Registration opens: ${formatDate(item.registrationOpen)}`
          );
        if (item.registrationClose)
          descParts.push(
            `Registration closes: ${formatDate(item.registrationClose)}`
          );
        if (item.eventDate)
          descParts.push(`Event date: ${formatDate(item.eventDate)}`);
        const desc = descParts.join(" | ").replace(/,/g, "\\,");
        lines.push(`DESCRIPTION:${desc}`);
        lines.push("END:VEVENT");
      });

      lines.push("END:VCALENDAR");

      const blob = new Blob([lines.join("\r\n")], {
        type: "text/calendar;charset=utf-8"
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "kidcal-reminders.ics";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function clearReminders() {
      if (!reminders.length) return;
      if (!confirm("Clear all reminders on this device? This cannot be undone.")) {
        return;
      }
      reminders = [];
      saveReminders();
      renderReminders();
    }

    // ---------------------------
    // Init
    // ---------------------------
    document
      .getElementById("searchBtn")
      .addEventListener("click", handleSearch);

    document
      .getElementById("locationInput")
      .addEventListener("keydown", (e) => {
        if (e.key === "Enter") handleSearch();
      });

    document
      .getElementById("useSampleBtn")
      .addEventListener("click", handleUseSample);

    document
      .getElementById("filterPills")
      .addEventListener("click", handleFilterClick);

    document
      .getElementById("downloadIcsBtn")
      .addEventListener("click", generateICS);

    document
      .getElementById("clearRemindersBtn")
      .addEventListener("click", clearReminders);

    renderHeroDeadlines();
    loadReminders();
    loadSheetData(); // pulls partner-maintained data from Google Sheets
  </script>
</body>
</html>


